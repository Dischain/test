let
	threshold = 2,
	totalRunning = 0,
	urls = ['/h2', '/h1', '/h3', '/h4'];

function aq() {

	/*complete = false,
	curTask = -1,*/
	console.log('totalRunning: ' + totalRunning);
	while (totalRunning < threshold && urls.length > 0) {
		let url = urls.shift();
		console.log(url);
		fetch(url).then((resp) => {
			console.log(resp.text())
			totalRunning--;
			if (urls.length > 0) {
				aq();
			} else if (totalRunning === 0) {
				console.log('done');
			}
		});

		totalRunning++;
	}
}

aq();
